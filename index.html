<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Tyler's Manga Library</title>
<style>
body{background:#2C2F33;color:#FFF;font-family:Helvetica,Arial,sans-serif;margin:0;padding:0;}
.container{max-width:1200px;margin:0 auto;padding:20px;}
h1{text-align:center;color:#7289DA;margin-top:10px;}
#searchInput { width: 60%; margin: 12px auto; display: block; padding: 10px; font-size: 14px; border-radius: 6px; border: 1px solid #444; background: #23272A; color: #FFF;}
.grid{display:flex;flex-wrap:wrap;justify-content:center;gap:20px;padding:20px;}
.card{background:#23272A;width:150px;border-radius:8px;overflow:hidden;text-align:center;transition: transform 0.12s;cursor:pointer;box-shadow:0 2px 6px rgba(0,0,0,0.4);}
.card:hover{transform: scale(1.05);}
.card img{width:150px;height:220px;object-fit:cover;display:block;margin:0 auto;background:#ddd;}
.card .title{font-weight:bold;margin:6px 8px;font-size:13px;min-height:36px;}
.card .meta{font-size:11px;margin:2px;color:#BBB;padding-bottom:8px;}
</style>
</head>
<body>
<div class="container">
<h1>Tyler's Manga Library</h1>
<input type="text" id="searchInput" onkeyup="searchLibrary()" placeholder="Search by title, author, publisher, ISBN...">
<div class="grid" id="bookGrid"></div>
</div>

<script>
// Search filter
function searchLibrary() {
    let input = document.getElementById('searchInput').value.toLowerCase();
    let cards = document.getElementsByClassName('card');
    for (let i=0;i<cards.length;i++){
        let card = cards[i];
        let text = card.innerText.toLowerCase();
        card.style.display = text.includes(input) ? '' : 'none';
    }
}

// Fetch and render books from lib.json
fetch('lib.json')
  .then(res => res.json())
  .then(books => {
      const grid = document.getElementById('bookGrid');
        books.sort((a, b) => {
            // Extract base series name (strip ", Vol. X")
            const baseA = (a.Title || '').replace(/,\s*Vol\.\s*\d+/i, '').trim().toLowerCase();
            const baseB = (b.Title || '').replace(/,\s*Vol\.\s*\d+/i, '').trim().toLowerCase();

            // If same series, compare volume numbers numerically
            if (baseA === baseB) {
                const volA = parseInt((a.Title || '').match(/Vol\.\s*(\d+)/i)?.[1] || 0);
                const volB = parseInt((b.Title || '').match(/Vol\.\s*(\d+)/i)?.[1] || 0);
                return volA - volB;
            }

            // Otherwise sort alphabetically by base title
            return baseA.localeCompare(baseB);
        }).forEach(b => {
          let cover = b.Cover || 'https://via.placeholder.com/150x220?text=No+Cover';
          let title = b.Title || '';
          let authors = b.Authors && b.Authors !== 'Unknown' ? b.Authors+'<br>' : '';
          let publisher = b.Publisher && b.Publisher !== 'Unknown' ? b.Publisher+'<br>' : '';
          let date = b.Date && b.Date !== 'Unknown' ? b.Date+'<br>' : '';
          let isbn = b.ISBN && b.ISBN !== 'Unknown' ? b.ISBN : '';

          let card = document.createElement('div');
          card.className = 'card';
          card.title = title;
          card.innerHTML = `<img src="${cover}" alt="Cover" onclick="window.open('${cover}','_blank')">
                            <div class="title">${title}</div>
                            <div class="meta">${authors}${publisher}${date}${isbn}</div>`;
          grid.appendChild(card);
      });
  })
  .catch(err => console.error('Failed to load lib.json', err));
</script>
</body>
</html>